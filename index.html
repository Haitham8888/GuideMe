<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="GuideMe - مساعد ذكي للمحادثة مخصص لذوي الإعاقة البصرية">
    <title>GuideMe - مساعدك الذكي</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <!-- Skip to main content for screen readers -->
    <a href="#chat-container" class="skip-link" aria-label="انتقل إلى منطقة المحادثة">انتقل إلى المحادثة</a>

    <!-- Header -->
    <header class="app-header">
        <div class="header-content">
            <h1 class="logo" tabindex="0" aria-label="GuideMe - مساعدك الذكي">
                <span class="logo-icon" aria-hidden="true">
                    <img src="logo.png" alt="لوجو GuideMe" width="32" height="32" style="object-fit: contain;">
                </span>
                <span class="logo-text">GuideMe</span>
            </h1>
            <nav class="header-nav" aria-label="قائمة التحكم">
                <button class="nav-btn" id="new-chat-btn" aria-label="بدء محادثة جديدة">
                    <span class="btn-icon" aria-hidden="true">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                    </span>
                    <span class="btn-text">محادثة جديدة</span>
                </button>
                <button class="nav-btn" id="settings-btn" aria-label="فتح الإعدادات">
                    <span class="btn-icon" aria-hidden="true">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M12 1V3M12 21V23M4.22 4.22L5.64 5.64M18.36 18.36L19.78 19.78M1 12H3M21 12H23M4.22 19.78L5.64 18.36M18.36 5.64L19.78 4.22"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                    </span>
                    <span class="btn-text">الإعدادات</span>
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Chat Container -->
    <main id="chat-container" class="chat-container" tabindex="-1" aria-label="محتوى المحادثة">
        <!-- Welcome Screen -->
        <div class="welcome-screen" id="welcome-screen" aria-labelledby="welcome-heading">
            <div class="welcome-content">
                <div class="welcome-icon" aria-hidden="true">
                    <img src="logo.png" alt="" width="120" height="120" style="object-fit: contain; filter: drop-shadow(var(--shadow-md));">
                </div>
                <h2 id="welcome-heading" class="welcome-title">مرحباً بك في GuideMe</h2>
                <p class="welcome-subtitle">مساعدك الذكي المصمم خصيصاً لذوي الإعاقة البصرية</p>

                <div class="welcome-features" aria-label="الميزات المتاحة">
                    <div class="feature-item" role="listitem">
                        <span class="feature-icon" aria-hidden="true">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M12 1C12 1 8 5 8 9C8 11.2091 9.79086 13 12 13C14.2091 13 16 11.2091 16 9C16 5 12 1 12 1Z"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                                <path
                                    d="M12 13V23M8 19H16M19 10V11C19 14.866 15.866 18 12 18C8.13401 18 5 14.866 5 11V10"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                            </svg>
                        </span>
                        <span class="feature-text">تحدث باستخدام المايك</span>
                    </div>
                    <div class="feature-item" role="listitem">
                        <span class="feature-icon" aria-hidden="true">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor"
                                    stroke-width="2" />
                                <circle cx="8.5" cy="8.5" r="1.5" fill="currentColor" />
                                <path d="M21 15L16 10L5 21" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </span>
                        <span class="feature-text">التقط صورة أو ابدأ بث مباشر</span>
                    </div>
                    <div class="feature-item" role="listitem">
                        <span class="feature-icon" aria-hidden="true">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                        </span>
                        <span class="feature-text">اكتب رسالتك</span>
                    </div>
                </div>

                <p class="welcome-hint">ابدأ بكتابة رسالة أو استخدم المايك أو الكاميرا</p>
            </div>
        </div>

        <!-- Chat Messages Area -->
        <div class="messages-area" id="messages-area" aria-live="polite" aria-atomic="false"
            aria-label="الرسائل المتبادلة">
            <!-- Messages will be added here dynamically -->
        </div>

        <!-- Camera Preview (Hidden by default) -->
        <div class="camera-preview" id="camera-preview" role="region" aria-labelledby="camera-heading" hidden>
            <div class="camera-header">
                <h3 id="camera-heading">معاينة الكاميرا</h3>
                <button class="close-camera-btn" id="close-camera-btn" aria-label="إغلاق الكاميرا">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                </button>
            </div>
            <video id="camera-video" class="camera-video" autoplay playsinline aria-label="بث الكاميرا المباشر"></video>
            <canvas id="camera-canvas" class="camera-canvas" hidden></canvas>
            <div class="camera-controls">
                <button class="camera-action-btn" id="capture-btn" aria-label="التقاط صورة">
                    <span class="btn-icon" aria-hidden="true">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="13" r="3" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M3 9C3 7.89543 3.89543 7 5 7H7L9 4H15L17 7H19C20.1046 7 21 7.89543 21 9V18C21 19.1046 20.1046 20 19 20H5C3.89543 20 3 19.1046 3 18V9Z"
                                stroke="currentColor" stroke-width="2" />
                        </svg>
                    </span>
                    <span class="btn-text">التقاط صورة</span>
                </button>
                <button class="camera-action-btn secondary" id="toggle-camera-btn" aria-label="تبديل الكاميرا">
                    <span class="btn-icon" aria-hidden="true">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M1 4V10H7M23 20V14H17M20.49 9C19.9828 7.56678 19.1209 6.28536 17.9845 5.27542C16.8482 4.26548 15.4745 3.55976 13.9917 3.22426C12.5089 2.88875 10.9652 2.93434 9.50481 3.35677C8.04437 3.77921 6.71475 4.56471 5.64 5.64L1 10M23 14L18.36 18.36C17.2853 19.4353 15.9556 20.2208 14.4952 20.6432C13.0348 21.0657 11.4911 21.1112 10.0083 20.7757C8.52547 20.4402 7.1518 19.7345 6.01547 18.7246C4.87913 17.7146 4.01717 16.4332 3.51 15"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </span>
                    <span class="btn-text">تبديل الكاميرا</span>
                </button>
            </div>
        </div>
    </main>

    <!-- Input Area -->
    <footer class="input-area" aria-label="أدوات الإدخال">
        <div class="input-container">
            <!-- Microphone Button -->
            <button class="input-action-btn mic-btn" id="mic-btn" aria-label="تسجيل رسالة صوتية" aria-pressed="false">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 1C12 1 8 5 8 9C8 11.2091 9.79086 13 12 13C14.2091 13 16 11.2091 16 9C16 5 12 1 12 1Z"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M12 13V23M8 19H16M19 10V11C19 14.866 15.866 18 12 18C8.13401 18 5 14.866 5 11V10"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
            </button>

            <!-- Camera Button -->
            <button class="input-action-btn camera-btn" id="camera-btn" aria-label="فتح الكاميرا" aria-pressed="false">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2" />
                    <circle cx="8.5" cy="8.5" r="1.5" fill="currentColor" />
                    <path d="M21 15L16 10L5 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </button>

            <!-- Text Input -->
            <div class="text-input-wrapper">
                <label for="message-input" class="sr-only">اكتب رسالتك هنا</label>
                <textarea id="message-input" class="message-input" placeholder="اكتب رسالتك هنا..." rows="1"
                    aria-label="حقل إدخال الرسالة" aria-describedby="input-hint"></textarea>
                <span id="input-hint" class="sr-only">اضغط Enter للإرسال، Shift+Enter لسطر جديد</span>
            </div>

            <!-- Send Button -->
            <button class="send-btn" id="send-btn" aria-label="إرسال الرسالة" disabled>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </button>
        </div>

        <!-- Recording Indicator -->
        <div class="recording-indicator" id="recording-indicator" role="status" aria-live="polite" hidden>
            <span class="recording-dot" aria-hidden="true"></span>
            <span class="recording-text">جاري التسجيل...</span>
            <span class="recording-duration" id="recording-duration" aria-live="polite">0:00</span>
        </div>
    </footer>

    <!-- Settings Modal -->
    <div class="modal" id="settings-modal" role="dialog" aria-labelledby="settings-modal-title" aria-modal="true"
        hidden>
        <div class="modal-overlay" id="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="settings-modal-title">الإعدادات</h2>
                <button class="modal-close-btn" id="close-settings-btn" aria-label="إغلاق الإعدادات">
                    <span aria-hidden="true">✕</span>
                </button>
            </div>
            <div class="modal-body">
                <form class="settings-form" id="settings-form">
                    <fieldset class="settings-group">
                        <legend>إعدادات الصوت</legend>

                        <div class="setting-item">
                            <label for="voice-speed">سرعة قراءة النصوص</label>
                            <div class="range-control">
                                <input type="range" id="voice-speed" min="0.5" max="2" step="0.1" value="1"
                                    aria-valuemin="0.5" aria-valuemax="2" aria-valuenow="1">
                                <output for="voice-speed" id="voice-speed-output">1x</output>
                            </div>
                        </div>

                        <div class="setting-item">
                            <label for="voice-volume">مستوى الصوت</label>
                            <div class="range-control">
                                <input type="range" id="voice-volume" min="0" max="100" value="80" aria-valuemin="0"
                                    aria-valuemax="100" aria-valuenow="80">
                                <output for="voice-volume" id="voice-volume-output">80%</output>
                            </div>
                        </div>
                    </fieldset>

                    <fieldset class="settings-group">
                        <legend>إعدادات الذكاء الاصطناعي</legend>
                        <div class="setting-item">
                            <label for="ai-url">رابط السيرفر المحلي (Ollama/Ngrok)</label>
                            <input type="url" id="ai-url" class="setting-select" placeholder="http://localhost:11434">
                            <p style="font-size: 0.8rem; color: var(--text-tertiary); margin-top: 0.5rem;">
                                اتركها كما هي للتشغيل المحلي، أو ضع رابط Ngrok للتشغيل عن بعد.
                            </p>
                        </div>
                    </fieldset>

                    <fieldset class="settings-group">
                        <legend>إعدادات العرض</legend>

                        <div class="setting-item">
                            <label for="font-size">حجم الخط</label>
                            <select id="font-size" class="setting-select">
                                <option value="small">صغير</option>
                                <option value="medium" selected>متوسط</option>
                                <option value="large">كبير</option>
                                <option value="xlarge">كبير جداً</option>
                            </select>
                        </div>

                        <div class="setting-item checkbox-item">
                            <input type="checkbox" id="dark-mode" class="setting-checkbox">
                            <label for="dark-mode">الوضع الداكن (Dark Mode)</label>
                        </div>

                        <div class="setting-item checkbox-item">
                            <input type="checkbox" id="high-contrast" class="setting-checkbox">
                            <label for="high-contrast">وضع التباين العالي</label>
                        </div>

                        <div class="setting-item checkbox-item">
                            <input type="checkbox" id="reduce-motion" class="setting-checkbox">
                            <label for="reduce-motion">تقليل الحركة</label>
                        </div>
                    </fieldset>

                    <div class="modal-actions">
                        <button type="submit" class="modal-btn primary">حفظ</button>
                        <button type="button" class="modal-btn secondary" id="cancel-settings-btn">إلغاء</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Announcements for screen readers -->
    <div role="status" aria-live="polite" aria-atomic="true" class="sr-only" id="announcements"></div>

    <!-- Scripts -->
    <script src="app.js"></script>
</body>

</html>